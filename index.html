<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>US Citizenship Quiz</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, Arial, sans-serif;
  background:#f6f7fb;
  margin:0; padding:20px;
}
.card {
  max-width:720px;
  margin:auto;
  background:#fff;
  padding:24px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,0.08);
}
h1 {margin-top:0;}
button {
  width:100%;
  padding:12px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#0066cc;
  color:#fff;
  cursor:pointer;
  margin-top:8px;
}
button.small {width:auto; padding:8px 14px; font-size:14px;}
button.secondary {background:#555;}
.opt {
  width:100%;
  text-align:left;
  background:#f4f4f4;
  border-radius:10px;
  padding:10px 14px;
  margin-top:10px;
  border:1px solid transparent;
}
.opt:hover {background:#e9f2ff;}
.opt.correct {background:#d4f8d4; border-color:#4caf50;}
.opt.wrong {background:#ffd4d4; border-color:#f44336;}
.opt.disabled {pointer-events:none; opacity:0.7;}
.row {display:flex; flex-wrap:wrap; gap:8px;}
.chip {
  background:#e0e0e0;
  border-radius:20px;
  padding:4px 10px;
  font-size:13px;
}
.chip strong {color:#111;}
.split {margin-top:16px; border-bottom:1px solid #ddd;}
.sub {font-size:14px; color:#444; margin-top:-6px; margin-bottom:10px;}
</style>
</head>
<body>

<div class="card">
  <h1>US Citizenship Quiz</h1>
  <div class="sub">å®˜æ–¹128é¢˜ï¼ˆ2025ç‰ˆï¼‰ï½œè‹±ä¸­å¯¹ç…§é€‰æ‹©é¢˜ç‰ˆ</div>

  <div class="row">
    <div class="chip">Mode: <strong id="modeChip">Practice</strong></div>
    <div class="chip">Progress: <strong id="progress">0/0</strong></div>
    <div class="chip">Score: <strong id="score">0</strong></div>
    <div class="chip">Wrong saved: <strong id="wrongCount">0</strong></div>
  </div>

  <div class="split"></div>

  <div class="row" style="margin-top:12px;">
    <button class="small" onclick="startPractice(20)">ğŸ§© Practice 20</button>
    <button class="small" onclick="startFull()">ğŸ“˜ Full 128</button>
    <button class="small" onclick="reviewWrong()">âŒ Wrong Review</button>
    <button class="small secondary" onclick="clearWrong()">ğŸ—‘ Clear Wrong</button>
  </div>

  <div class="split"></div>

  <div id="quizArea" style="margin-top:16px;"></div>

  <div class="split"></div>

  <div class="row" style="margin-top:12px;">
    <button id="nextBtn" onclick="nextQuestion()">Next / ä¸‹ä¸€é¢˜</button>
  </div>
</div>

<script src="questions.js"></script>
<script>
let questions = [];
let current = 0;
let score = 0;
let mode = 'practice';
let wrongList = JSON.parse(localStorage.getItem('wrongList') || '[]');
let currentSet = [];

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

function randomOptions(q){
  const correct = q.answers_en[0];
  const options = [correct];
  while(options.length<4){
    const r = QUESTIONS[Math.floor(Math.random()*QUESTIONS.length)];
    const a = r.answers_en[0];
    if(a && !options.includes(a)) options.push(a);
  }
  return shuffle(options);
}

function startPractice(n=20){
  mode='practice';
  currentSet = shuffle([...QUESTIONS]).slice(0,n);
  current=0; score=0;
  document.getElementById('modeChip').innerText='Practice '+n;
  showQuestion();
}

function startFull(){
  mode='full';
  currentSet = shuffle([...QUESTIONS]);
  current=0; score=0;
  document.getElementById('modeChip').innerText='Full 128';
  showQuestion();
}

function reviewWrong(){
  if(wrongList.length===0){alert("æš‚æ— é”™é¢˜ã€‚");return;}
  mode='wrong';
  currentSet = QUESTIONS.filter(q=>wrongList.includes(q.id));
  current=0; score=0;
  document.getElementById('modeChip').innerText='Wrong Review';
  showQuestion();
}

function clearWrong(){
  if(confirm("ç¡®å®šè¦æ¸…é™¤é”™é¢˜è®°å½•å—ï¼Ÿ")){
    wrongList=[];
    localStorage.setItem('wrongList','[]');
    updateInfo();
    alert("å·²æ¸…é™¤é”™é¢˜è®°å½•ã€‚");
  }
}

function showQuestion(){
  const q = currentSet[current];
  if(!q){alert("å®Œæˆï¼ åˆ†æ•°ï¼š"+score+"/"+currentSet.length);return;}
  updateInfo();
  const opts = randomOptions(q);
  const area = document.getElementById('quizArea');
  area.innerHTML = `
    <div style="margin-bottom:12px;font-weight:bold;">${current+1}. ${q.en}</div>
    <div style="color:#555;margin-bottom:8px;">${q.zh}</div>
    ${opts.map(o=>`<div class='opt' onclick='selectOption(this, "${escapeHTML(o)}", "${escapeHTML(q.answers_en[0])}", ${q.id})'>${o}</div>`).join('')}
  `;
}

function selectOption(el, chosen, correct, id){
  const opts=document.querySelectorAll('.opt');
  opts.forEach(o=>o.classList.add('disabled'));
  if(chosen===correct){
    el.classList.add('correct');
    score++;
  }else{
    el.classList.add('wrong');
    if(!wrongList.includes(id)){
      wrongList.push(id);
      localStorage.setItem('wrongList',JSON.stringify(wrongList));
    }
  }
  updateInfo();
}

function nextQuestion(){
  current++;
  if(current>=currentSet.length){
    alert("æµ‹éªŒç»“æŸ âœ… å¾—åˆ†ï¼š"+score+"/"+currentSet.length);
  }else{
    showQuestion();
  }
}

function updateInfo(){
  document.getElementById('progress').innerText=`${current+1}/${currentSet.length}`;
  document.getElementById('score').innerText=score;
  document.getElementById('wrongCount').innerText=wrongList.length;
}

function escapeHTML(str){
  return str.replace(/</g,"&lt;").replace(/>/g,"&gt;");
}

// åˆå§‹åŒ–
updateInfo();
</script>
</body>
</html>
